<!DOCTYPE html>
<html lang="nn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KÃ¸yr fint!</title>
  <style>
    body {
      margin: 0;
      background: #111;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #scene {
      position: relative;
      width: 200px;
      height: 200px;
    }

    svg {
      width: 100%;
      height: auto;
      transition: transform 0.1s linear;
    }

    .spy {
      position: absolute;
      top: 90px;
      width: 60px;
      height: 30px;
      background: radial-gradient(circle, #7f0, #4b0);
      opacity: 0;
      transform: scale(1) rotate(0deg);
      border-radius: 50%;
      animation: sprut 0.5s ease-out forwards;
    }

    #spy-venstre {
      left: -40px;
      transform: rotate(-20deg);
    }

    #spy-hogre {
      right: -40px;
      transform: rotate(20deg);
    }

    @keyframes sprut {
      0% { opacity: 1; transform: scale(0.5); }
      100% { opacity: 0; transform: scale(2); }
    }
  </style>
</head>
<body>
  <div id="scene">
    <!-- SVG av bil sett bakfra -->
    <svg id="bil" viewBox="0 0 100 100">
      <!-- Bilkropp -->
      <rect x="20" y="20" width="60" height="40" rx="10" ry="10" fill="darkblue" stroke="black" stroke-width="2"/>
      <!-- Bakrute -->
      <rect x="30" y="30" width="40" height="20" rx="3" ry="3" fill="lightblue" stroke="black" stroke-width="1"/>
      <!-- Baklys -->
      <rect x="21" y="60" width="4" height="10" fill="red"/>
      <rect x="75" y="60" width="4" height="10" fill="red"/>
      <!-- Hjul -->
      <rect x="25" y="60" width="10" height="10" fill="darkgrey"/>
      <rect x="65" y="60" width="10" height="10" fill="darkgrey"/>
    </svg>

    <!-- Spy -->
    <div id="spy-venstre" class="spy"></div>
    <div id="spy-hogre" class="spy"></div>
  </div>

  <script>
    const bil = document.getElementById('bil');
    const spyV = document.getElementById('spy-venstre');
    const spyH = document.getElementById('spy-hogre');

    function spyUt(retning) {
      const el = retning === 'venstre' ? spyV : spyH;
      el.style.animation = 'none';
      void el.offsetWidth; // restart
      el.style.animation = 'sprut 0.5s ease-out forwards';
    }

    function startApp() {
      window.addEventListener('devicemotion', (e) => {
        const x = e.accelerationIncludingGravity?.x || 0;
        const rot = Math.max(-20, Math.min(20, -x * 3));
        bil.style.transform = `rotate(${rot}deg)`;

        if (Math.abs(x) > 6) {
          if (x > 0) spyUt('venstre');
          else spyUt('hogre');
        }
      });
    }

    // iOS krever tillating
    if (typeof DeviceMotionEvent?.requestPermission === 'function') {
      const knapp = document.createElement('button');
      knapp.textContent = "Start";
      knapp.style.padding = "1em";
      knapp.onclick = () => {
        DeviceMotionEvent.requestPermission().then(res => {
          if (res === 'granted') startApp();
        });
        knapp.remove();
      };
      document.body.appendChild(knapp);
    } else {
      startApp(); // Android
    }
  </script>
</body>
</html>
